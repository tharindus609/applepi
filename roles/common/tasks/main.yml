---
- name: Update caches, perform a full upgrade and a little housekeep
  become: true
  ansible.builtin.apt:
    update_cache: true
    upgrade: full
    autoclean: true
    autoremove: true

- name: Install required package
  become: true
  ansible.builtin.apt:
    name:
      - python3-pip
      - vim
      - dnsutils
      - libnfs-utils
    state: present

- name: Mount external drives
  become: true
  mount:
    path: "{{ item.mount_path }}"
    src: "PARTUUID={{ item.partuuid }}"
    fstype: auto
    opts: "defaults,nofail,dmask=0022,fmask=0137,gid={{ ansible_user_gid }},uid={{ ansible_user_uid }}"
    state: mounted
    backup: true
  with_items: "{{ ext_disk_map }}"
